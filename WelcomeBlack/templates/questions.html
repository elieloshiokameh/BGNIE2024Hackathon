{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="quiz-container">
    <h2>How do you say the following in English?</h2>

    <!-- Question Text -->
    <h3 id="question-text">
        {% if questions.0.twi_word %}
            {{ questions.0.twi_word }}
        {% else %}
            {{ questions.0.yoruba_word }}
        {% endif %}
    </h3>

    <!-- Options -->
    <div class="options">
        {% for option in questions.0.options %}
        <button class="option-btn">{{ option }}</button>
        {% endfor %}
    </div>

    <!-- Next Button -->
    <button id="next-btn" class="btn" onclick="nextQuestion()">Next</button>

    <!-- Progress Bar -->
    <div class="progress-bar">
        <div id="progress" class="progress" style="width: 0%;"></div>
    </div>
</div>

<script>
    const questions = {{ questions|safe }};  // Pass the questions as JSON
    let currentQuestionIndex = 0;
    const totalQuestions = questions.length;

    // Function to shuffle array (Fisher-Yates shuffle)
    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
    }

    // Function to load a new question
    function loadQuestion() {
        const question = questions[currentQuestionIndex];

        // Shuffle the options for this question
        shuffleArray(question.options);

        // Update question text
        document.getElementById('question-text').innerText = question.twi_word || question.yoruba_word;

        // Update options
        const optionsContainer = document.querySelector('.options');
        optionsContainer.innerHTML = '';  // Clear existing options

        question.options.forEach(option => {
            const button = document.createElement('button');
            button.className = 'option-btn';
            button.innerText = option;
            button.onclick = () => checkAnswer(button, question.correct_translation);
            optionsContainer.appendChild(button);
        });
    }

    // Function to check the selected answer
    function checkAnswer(button, correctAnswer) {
        if (button.innerText === correctAnswer) {
            button.style.backgroundColor = 'green';
        } else {
            button.style.backgroundColor = 'red';
        }
    }

    // Function to move to the next question
    function nextQuestion() {
        currentQuestionIndex++;
        if (currentQuestionIndex < totalQuestions) {
            loadQuestion();
            const progress = (currentQuestionIndex / totalQuestions) * 100;
            document.getElementById('progress').style.width = progress + '%';
        } else {
            alert('Quiz completed!');
        }
    }

    // Load the first question when the page is loaded
    loadQuestion();
</script>
{% endblock %}
